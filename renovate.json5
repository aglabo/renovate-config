// src: .renovaterc.json
// @(#) : renovate 基本設定
//
// Copyright (c) 2025 atsushifx <http://github.com/atsushifx>
//
// This software is released under the MIT License.
// https://opensource.org/licenses/MIT

{
  "$schema": "https://docs.renovatebot.com/renovate-schema.json",
  "extends": [
    "config:recommended"
  ],

  // --- 基本設定 ---
  "timezone": "Asia/Tokyo",

  "schedule": [
    "after 1am and before 3am on monday"
  ],

  "automergeSchedule": [
    "after 3am and before 6am on monday"
  ],

  // Avoid PR overflow by setting hourly limit
  "prHourlyLimit": 20,

  // Allow rebase even outside schedule
  "updateNotScheduled": true,

  // dependency dashboard = ON
  "dependencyDashboard": true,

  // Internal checks suppression (keep current settings)
  // "internalChecksFilter": "none",

  // --- packageRules ---
  "packageRules": [
    {
      // GitHub Actions のみ replace（digest pinning）
      "matchManagers": ["github-actions"],
      "rangeStrategy": "replace",
      "pinDigests": true
    },
    {
      // Major updates: grouped, min release age, labels, no auto-merge
      "matchUpdateTypes": ["major"],
      "minimumReleaseAge": "5 days",
      "addLabels": ["renovate/major"],
      "groupName": "major dependency updates",
      "groupSlug": "major-updates"
    },
    {
      "matchPackageNames": [
        "actions/checkout",
        "actions/setup-node",
        "actions/setup-python"
      ],
      "extends": [ "schedule:earlyMondays"  ],  // check updates weekly
      "automerge": false,
      "addLabels": ["security-critical"]
    },
    {
      // Minor updates: auto-merge + release age
      "matchUpdateTypes": ["minor"],
      "minimumReleaseAge": "5 days",
      "addLabels": ["renovate/minor"],
      "automerge": true
    },
    {
      // Patch updates: auto-merge + release age
      "matchUpdateTypes": ["patch"],
      "minimumReleaseAge": "3 days",
      "addLabels": ["renovate/patch"],
      "automerge": true
    },
    {
      // Pin updates: auto-merge GitHub Actions only
      "matchManagers": ["github-actions"],
      "matchUpdateTypes": ["pin"],
      "addLabels": ["renovate/pin"],
      "automerge": true
    }
  ]
}
